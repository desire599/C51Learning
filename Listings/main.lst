C51 COMPILER V9.60.0.0   MAIN                                                              12/06/2020 20:09:54 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: C:\Program Files (x86)\Keil_v5\C51\BIN\C51.EXE src\main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTE
                    -ND PRINT(.\Listings\main.lst) TABS(2) OBJECT(.\Objects\main.obj)

line level    source

   1          #include <reg52.h>
   2          #include <stdio.h>
   3          #include <string.h>
   4          
   5          /*-----ç«¯å£å®šä¹‰-----*/
   6          #define DataPort P1 // LCDæ•°æ®çº¿D0-D7
   7          sbit RS = P2 ^ 2;   // æ•°æ®\æŒ‡ä»¤ é€‰æ‹© RS
   8          sbit RW = P2 ^ 1;   // è¯»\å†™ é€‰æ‹©
   9          sbit E = P2 ^ 0;    // è¯»\å†™ä½¿èƒ½
  10          sbit cs1 = P2 ^ 4;  // ç‰‡é€‰1
  11          sbit cs2 = P2 ^ 3;  // ç‰‡é€‰2
  12          
  13          /*-----å®šä¹‰LCDå¤§å°-----*/
  14          #define LCD_X_MAX 128 //   å®šä¹‰æ¶²æ™¶xè½´çš„åƒç´ æ•° *
  15          #define LCD_Y_MAX 64  //   å®šä¹‰æ¶²æ™¶yè½´çš„åƒç´ æ•° *
  16          
  17          //ASCII å­—æ¨¡å®½åº¦åŠé«˜åº¦
  18          #define ASC_CHR_WIDTH 8
  19          #define ASC_CHR_HEIGHT 16
  20          #define HZ_CHR_WIDTH 16
  21          #define HZ_CHR_HEIGHT 16
  22          
  23          #define uchar unsigned char
  24          
  25          uchar code GB_16[5][32] ={ //5è¡Œï¼Œè¡¨ç¤º5ä¸ªæ±‰å­—ï¼›æ¯ä¸ªæ±‰å­—æœ‰32ä¸ªå­—ç 
  26          
  27           //å•(0) ç‰‡(1) æœº(2) æŠ€(3) æœ¯(4)
  28          
  29          {0x00,0x00,0xF8,0x49,0x4A,0x4C,0x48,0xF8, 
  30          0x48,0x4C,0x4A,0x49,0xF8,0x00,0x00,0x00, //ä»¥ä¸Š16åˆ—ä¸ºæ±‰å­—ä¸ŠåŠéƒ¨åˆ†
  31          0x10,0x10,0x13,0x12,0x12,0x12,0x12,0xFF, //ä»¥ä¸‹16åˆ—ä¸ºæ±‰å­—ä¸‹åŠéƒ¨åˆ†
  32          0x12,0x12,0x12,0x12,0x13,0x10,0x10,0x00},/*"å•",0*/
  33          
  34          {0x00,0x00,0x00,0xFE,0x20,0x20,0x20,0x20,
  35          0x20,0x3F,0x20,0x20,0x20,0x20,0x00,0x00,
  36          0x00,0x80,0x60,0x1F,0x02,0x02,0x02,0x02,
  37          0x02,0x02,0xFE,0x00,0x00,0x00,0x00,0x00},/*"ç‰‡",1*/
  38          
  39          {0x10,0x10,0xD0,0xFF,0x90,0x10,0x00,0xFE,
  40          0x02,0x02,0x02,0xFE,0x00,0x00,0x00,0x00,
  41          0x04,0x03,0x00,0xFF,0x00,0x83,0x60,0x1F,
  42          0x00,0x00,0x00,0x3F,0x40,0x40,0x78,0x00},/*"æœº",2*/
  43          
  44          {0x10,0x10,0x10,0xFF,0x10,0x90,0x08,0x88,
  45          0x88,0x88,0xFF,0x88,0x88,0x88,0x08,0x00,
  46          0x04,0x44,0x82,0x7F,0x01,0x80,0x80,0x40,
  47          0x43,0x2C,0x10,0x28,0x46,0x81,0x80,0x00},/*"æŠ€",3*/
  48          
  49          {0x00,0x10,0x10,0x10,0x10,0xD0,0x30,0xFF,
  50          0x30,0xD0,0x12,0x1C,0x10,0x10,0x00,0x00,
  51          0x10,0x08,0x04,0x02,0x01,0x00,0x00,0xFF,
  52          0x00,0x00,0x01,0x02,0x04,0x08,0x10,0x00},/*"æœ¯",4*/
  53          
  54          };
C51 COMPILER V9.60.0.0   MAIN                                                              12/06/2020 20:09:54 PAGE 2   

  55          
  56          /*--------å‡½æ•°åˆ—è¡¨-------*/
  57          /*-----çŠ¶æ€æ£€æŸ¥-----*/
  58          void Check_Busy(void)
  59          {
  60   1          uchar dat;
  61   1          RS = 0;
  62   1          RW = 1;
  63   1          do
  64   1          {
  65   2              DataPort = 0x00;
  66   2              E = 1;
  67   2              dat = DataPort;
  68   2              E = 0;
  69   2              dat = 0x80 & dat; //ä»…å½“ç¬¬7ä½ä¸º0æ—¶æ‰å¯æ“ä½œ(åˆ¤åˆ«busyä¿¡å·)
  70   2          } while (!(dat == 0x00));
  71   1      }
  72          
  73          /*-----å‘LCDå‘é€å‘½ä»¤------*/
  74          void Writ_Comd(uchar command)
  75          {
  76   1          Check_Busy();
  77   1          RW = 0;
  78   1          RS = 0;
  79   1          DataPort = command;
  80   1          E = 1;
  81   1          E = 0;
  82   1      }
  83          
  84          /*-----å†™æ˜¾ç¤ºæ•°æ®------*/
  85          void Write_Dat(uchar dat)
  86          {
  87   1          Check_Busy();
  88   1          RW = 0;
  89   1          RS = 1;
  90   1          DataPort = dat;
  91   1          E = 1;
  92   1          E = 0;
  93   1      }
  94          
  95          /*------è®¾å®šè¡Œåœ°å€(é¡µ)--X 0-7------*/
  96          void Set_Line(uchar line)
  97          {
  98   1          line = line & 0x07; // 0<=line<=7
  99   1          line = line | 0xb8; //1011 1xxx
 100   1          Writ_Comd(line);
 101   1      }
 102          
 103          /*------è®¾å®šåˆ—åœ°å€--Y å·¦å³åŠå±å„0-63åˆ—-----*/
 104          void Set_Column(uchar column)
 105          {
 106   1          column = column & 0x3f; // 0=<column<=63
 107   1          column = column | 0x40; // 01xx xxxx
 108   1          Writ_Comd(column);
 109   1      }
 110          
 111          /*-----è®¾å®šæ˜¾ç¤ºå¼€å§‹è¡Œ--XX-----*/
 112          void Set_StartLine(uchar startline) //0--63
 113          {
 114   1          startline = startline & 0x07;
 115   1          startline = startline | 0xc0; //1100 0000
 116   1          Writ_Comd(startline);
C51 COMPILER V9.60.0.0   MAIN                                                              12/06/2020 20:09:54 PAGE 3   

 117   1      }
 118          
 119          /*-----å¼€å…³æ˜¾ç¤º-----ONOFF=1:ON;ONOFF=0:OFF-----*/
 120          void Set_OnOff(uchar onoff)
 121          {
 122   1          onoff = 0x3e | onoff; //0011 111x
 123   1          Writ_Comd(onoff);
 124   1      }
 125          
 126          /*------é€‰æ‹©å±å¹•ï¼šscreE: 0-å…¨å±,1-å·¦å±,2-å³å±-----*/
 127          void Select_Screen(uchar screE)
 128          {
 129   1          switch (screE)
 130   1          {
 131   2          case 0:
 132   2              cs1 = 1; //é«˜ç”µå¹³æœ‰æ•ˆ
 133   2              cs2 = 1;
 134   2              break;
 135   2          case 1:
 136   2              cs1 = 0;
 137   2              cs2 = 1;//æœ‰äº›ç¡¬ä»¶çš„å·¦å³å±å¯èƒ½ä¸åŒï¼Œæ ¹æ®å®é™…æ˜¾ç¤ºæ•ˆæœè¿›è¡Œä¿®æ”¹
 138   2              break;
 139   2          case 2:
 140   2              cs1 = 1;
 141   2              cs2 = 0;
 142   2              break;
 143   2          }
 144   1      }
 145          
 146          /*-----æ¸…å±ï¼šscreE: 0-å…¨å±,1-å·¦å±,2-å³-----*/
 147          void LCD_Clr(uchar screE)
 148          {
 149   1          unsigned char i, j;
 150   1          Select_Screen(screE);
 151   1          for (i = 0; i < 8; i++)
 152   1          {
 153   2              Set_Line(i);              //é€‰æ‹©ä¸€è¡Œï¼Œæ€»å…±8è¡Œ
 154   2              for (j = 0; j < 128; j++) //æ¯è¡Œå…¨å±çš„è¯ï¼Œæ¯è¡Œæœ‰128åˆ—
 155   2              {
 156   3                  Write_Dat(0x00);
 157   3              }
 158   2          }
 159   1      }
 160          
 161          /*-----åˆå§‹åŒ–LCD------*/
 162          void LCD_Init(void)
 163          {
 164   1          uchar i = 250; //å»¶æ—¶
 165   1          while (i--)
 166   1              ;
 167   1          Select_Screen(0);  //é€‰æ‹©å±å¹•ï¼Œ0-å…¨å±
 168   1          Set_OnOff(0);     //å…³æ˜¾ç¤º
 169   1          LCD_Clr(0);       //æ¸…å±
 170   1          Select_Screen(0);  //é€‰æ‹©å±å¹•ï¼Œ0-å…¨å±
 171   1          Set_OnOff(1);     //å¼€æ˜¾ç¤º
 172   1          Select_Screen(0);  //é€‰æ‹©å±å¹•ï¼Œ0-å…¨å±
 173   1          Set_StartLine(0); //å¼€å§‹è¡Œ:0
 174   1      }
 175          
 176          // åœ¨æŒ‡å®šä½ç½®æ˜¾ç¤ºå­—ç¬¦ï¼šx=0-120ï¼ˆå­—æ¯ã€æ•°å­—ï¼‰/0-112ï¼ˆæ±‰å­—ï¼‰ï¼Œy=0-6
 177          void Out_Char(uchar x, uchar y, uchar i, bit mode) // xä¸ºåˆ—åæ ‡ï¼Œyä¸ºé¡µåæ ‡ï¼Œåœ¨æŒ‡å®šä½ç½®æ˜¾ç¤
             -ºå­—ç¬¦
C51 COMPILER V9.60.0.0   MAIN                                                              12/06/2020 20:09:54 PAGE 4   

 178            {     //iä¸ºæ±‰å­—æ•°ç»„è¡Œæ•°é€‰æ‹©ï¼Œmode=1ï¼Œæ­£å¸¸æ˜¾ç¤ºï¼ˆé˜´ç ï¼‰ï¼›mode=0ï¼Œåç™½æ˜¾ç¤ºï¼ˆé˜³ç 
             -ï¼‰
 179   1          unsigned char k;//å®šä¹‰åˆ—è®¡æ•°çš„å¾ªç¯å˜é‡
 180   1          int cData;
 181   1          for (k = 0; k < 2 * HZ_CHR_WIDTH; k++) //ç”±äºä¸€ä¸ªæ±‰å­—é‡‡ç”¨ä¸Šä¸‹ä¸¤ä¸ªéƒ¨åˆ†ï¼Œæ¯ä¸€éƒ¨åˆ†å 1
             -6åˆ—ï¼Œæ‰€ä»¥è¦å¾ªç¯16*2çš„åˆ—æ¬¡
 182   1          {
 183   2              if (mode == 1)
 184   2                  cData = GB_16[i][k]; //ä»GB_16æ±‰å­—æ•°ç»„ä¸­å–å¯¹åº”çš„æ±‰å­—å­—ç ï¼Œå­˜å…¥å‡†å¤‡æ•°æ®å­˜
             -å‚¨å˜é‡
 185   2              else
 186   2                  cData = ~GB_16[i][k];
 187   2              if (k < HZ_CHR_WIDTH) //æ±‰å­—ä¸ŠåŠéƒ¨
 188   2              {
 189   3                  if ((x + k) < 64) //åæ ‡åˆ—æ•°xçš„å€¼åŠ ä¸Šå½“å‰çš„æ‰«æåˆ—æ•°å¦‚æœå°äº64åˆ—ï¼Œåˆ™åªéœ
             -€è¦æ‰“å¼€å·¦åŠå±
 190   3                  {
 191   4                      Select_Screen(1); //é€‰æ‹©å·¦åŠå±
 192   4                      Set_Column(x + k); //æ­¤æ—¶çš„é€‰æ‹©åˆ—æ•°ä¸ºxåæ ‡+å½“å‰çš„kå€¼
 193   4                  }
 194   3                  else
 195   3                  {
 196   4                      Select_Screen(2); //é€‰æ‹©å³åŠå±
 197   4                      Set_Column(x + k - 64);
 198   4                  }
 199   3                  Set_Line(y);//è®¾ç½®é¡µæ•°ï¼Œæ¯é¡µ8è¡Œå¯¹åº”LCDé€šä¿¡æ•°æ®å£çš„8ä¸ªå¼•è„šçŠ¶æ€
 200   3              }
 201   2              else //æ±‰å­—ä¸‹åŠéƒ¨
 202   2              {
 203   3                  if ((x + k - HZ_CHR_WIDTH) < 64)
 204   3                  {
 205   4                      Select_Screen(1); //é€‰æ‹©å·¦åŠå±
 206   4                      Set_Column(x + k - HZ_CHR_WIDTH);
 207   4                  }
 208   3                  else
 209   3                  {
 210   4                      Select_Screen(2); //é€‰æ‹©å³åŠå±
 211   4                      Set_Column((x + k - HZ_CHR_WIDTH) - 64);
 212   4                  }
 213   3                  Set_Line(y + 1); //è®¾ç½®ä¸‹ä¸€é¡µ
 214   3              }
 215   2              Write_Dat(cData); //æŠŠæ±‰å­—å­—ç å‘é€åˆ°LCD
 216   2          }
 217   1      }
 218          void main()
 219          {
 220   1        unsigned char i,j=16;//iä¸ºæ±‰å­—æ•°ç»„çš„ä¸ªæ•°å¢é‡,jä¸ºåˆå§‹åæ ‡å€¼ï¼Œåˆ—æ•°
 221   1        LCD_Init(); //LCDåˆå§‹åŒ–
 222   1        for(i=0;i<5;i++)
 223   1        {
 224   2          Out_Char(j,0,i,0);
 225   2          j=j+16;
 226   2        }
 227   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    445    ----
   CONSTANT SIZE    =    160    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       4
C51 COMPILER V9.60.0.0   MAIN                                                              12/06/2020 20:09:54 PAGE 5   

   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----       1
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
